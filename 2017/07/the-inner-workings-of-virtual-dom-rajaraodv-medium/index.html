<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>è™šæ‹Ÿ DOM å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ | TryCatch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="react,è™šæ‹ŸDOM" />
    
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-92905809-1', 'auto');
ga('send', 'pageview');

</script>
    
    
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?409648b1638886ada0891d05cc80dc19";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

    
    
        <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
    
    

</head>

<body>
  <div id="root">
    <div id="page-percent">
      <div></div>
    </div>
    <div id="wrap">
      <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div id="header-nav" class="nav-container">
                <div class="container-inner nav-container-inner">
                    <ul id="main-nav">
                        
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">ä¸»é¡µ</a>
                                </li>
                        
                                <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Uncategory/">Uncategory</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/css/">css</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/html/">html</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/js/">js</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/ç¿»è¯‘/">ç¿»è¯‘</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/è½¬è½½/">è½¬è½½</a></li></ul>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/archives/index.html">index.archives</a>
                                </li>
                        
                    </ul>
                </div>
            </div>
            <div id="header-title" style="display: none">
                <div class="container-inner">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">To try, then catch.</p>
                        </h2>
                    
                </div>
            </div>
        </div>
    </div>
</header>
      <div class="container">
        <div class="bg_content">
          <canvas id="canvas"></canvas>
        </div>
        <div class="main-body container-inner">
          <div class="main-body-inner">
            <section id="main">
              <div class="main-body-content">
                <article id="post-the-inner-workings-of-virtual-dom-rajaraodv-medium" class="article article-single article-type-post" itemscope itemprop="blogPost">
    
    
        <h1 class="article-title" itemprop="name">
        è™šæ‹Ÿ DOM å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
        </h1>
    

    <header class="article-header" >
        <div class="article-author-avatar">
            <img src="/images/avatar.png" alt="Author's avatar">
        </div>
        <div class="article-subtitle">
            <div class="article-author">
                tcatche
            </div>
            <div class="article-meta">
                <a href="/2017/07/the-inner-workings-of-virtual-dom-rajaraodv-medium/" class="article-date">
    <i class="icon fa fa-calendar"></i>
    <time datetime="2017-07-05T02:42:00.000Z" itemprop="datePublished">2017-07-05</time>
</a>
                
    <span class="word-count">
      <i class="icon fa fa-file-text"></i>
      å­—æ•°: 3,140 
    </span>
    <span class="word-count">
      <i class="icon fa fa-clock-o"></i>
      é˜…è¯»æ—¶é•¿: 12mins 
    </span>

            </div>
            <div class="article-dir">
                
    <div class="article-category">
    <i class="icon fa fa-list-ul"></i>
    <a class="article-category-link" href="/categories/è½¬è½½/">è½¬è½½</a>
    </div>

                
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/è™šæ‹ŸDOM/">è™šæ‹ŸDOM</a></li></ul>

            </div>
        </div>
    </header>
    <div class="article-inner">
        
        <div class="article-entry" itemprop="articleBody">
            <blockquote>
<p>æœ¬æ–‡è½¬è½½è‡ªï¼š<a href="http://www.zcfy.cc" target="_blank" rel="external">ä¼—æˆç¿»è¯‘</a><br>è¯‘è€…ï¼š<a href="http://www.zcfy.cc/@1992xiao" target="_blank" rel="external">æˆ‘æ˜¯æ¬è¿å·¥</a><br>é“¾æ¥ï¼š<a href="http://www.zcfy.cc/article/3248" target="_blank" rel="external">http://www.zcfy.cc/article/3248</a><br>åŸæ–‡ï¼š<a href="https://medium.com/@rajaraodv/the-inner-workings-of-virtual-dom-666ee7ad47cf" target="_blank" rel="external">https://medium.com/@rajaraodv/the-inner-workings-of-virtual-dom-666ee7ad47cf</a></p>
</blockquote>
<p><img src="http://p0.qhimg.com/t01650dd501e89e96a2.png" alt=""></p>
<p>æµç¨‹å›¾å±•ç°VDOMåœ¨Preactä¸­å¦‚ä½•å·¥ä½œ</p>
<p>è™šæ‹ŸDOM (VDOM ä¹Ÿå« VNode)éå¸¸æœ‰é­”åŠ› âœ¨ ä½†æ˜¯ä¹Ÿéå¸¸å¤æ‚å’Œéš¾ä»¥ç†è§£ğŸ˜±. <a href="https://facebook.github.io/react/" target="_blank" rel="external">React</a>, åœ¨<a href="https://preactjs.com" target="_blank" rel="external">Preact</a>å’Œä¸€äº›ç±»ä¼¼çš„JSåº“çš„æ ¸å¿ƒä»£ç ä¸­ä½¿ç”¨. ä¸å¹¸çš„æ˜¯æˆ‘å‘ç°æ²¡æœ‰ä¸€ç¯‡å¥½çš„æ–‡ç« æˆ–è€…æ–‡æ¡£ç®€æ´æ˜äº†çš„æ¥ä»‹ç»å®ƒã€‚ å› æ­¤æˆ‘å†³å®šè‡ªå·±å†™ä¸€ç¯‡.</p>
<blockquote>
<p>æ³¨æ„: è¿™ç¯‡æ–‡ç« å¾ˆé•¿. æˆ‘å·²ç»æ·»åŠ å°½å¯èƒ½å¤šçš„å›¾ç‰‡æ¥ä½¿å…¶ç†è§£æ›´ç®€å•ä¸€äº›ï¼Œä½†æ˜¯æˆ‘å‘ç°è¿™æ ·çš„è¯ï¼Œæ–‡ç« æ›´é•¿äº†.</p>
<p>æˆ‘ç”¨çš„æ˜¯ <a href="https://github.com/developit/preact/" target="_blank" rel="external">Preactâ€™s</a> ä»£ç  å’Œ VDOMï¼Œå› ä¸ºå®ƒå¾ˆå°ï¼Œä½ å¯ä»¥åœ¨å°†æ¥å¾ˆèˆ’é€‚çš„é˜…è¯»å®ƒã€‚ <strong>ä½†æ˜¯æˆ‘ç›¸ä¿¡å‡ ä¹æ‰€æœ‰çš„æ¦‚å¿µåŒæ ·é€‚ç”¨äºReact.</strong></p>
<p><strong>æˆ‘å¸Œæœ›ä½ è¯»å®Œè¿™ç¯‡æ–‡ç« åï¼Œèƒ½å¤Ÿå¾ˆå®¹æ˜“çš„ç†è§£åƒReactæˆ–è€…Preactçš„åº“ï¼Œç”šè‡³å¯¹ä½ å†™å‡ºç±»ä¼¼çš„åº“ä¹Ÿæ˜¯æœ‰å¸®åŠ©çš„</strong></p>
</blockquote>
<p>åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°†ä¼šä¸¾ä¸€äº›ç®€å•ç¤ºä¾‹ï¼Œå¹¶ä¸”å¤ä¹ ä¸€ä¸‹ä¸åŒçš„å°çŸ¥è¯†ï¼Œç»™ä½ ä¸€ä¸ªå…³äºå®ƒä»¬åˆ°åº•å¦‚ä½•å·¥ä½œçš„æ¦‚å¿µã€‚ç‰¹åˆ«åœ°ï¼Œæˆ‘ä¼šå¤ä¹ ï¼š</p>
<ol>
<li>Babel å’Œ JSX</li>
<li>åˆ›å»ºä¸€ä¸ªVNode - ä¸€ä¸ªç®€å•çš„è™šæ‹ŸDOMå…ƒç´ </li>
<li>å¤„ç†ç»„ä»¶åŠå­ç»„ä»¶</li>
<li>åˆå§‹åŒ–æ¸²æŸ“å¹¶ä¸”åˆ›å»ºä¸€ä¸ªDOMå…ƒç´ </li>
<li>é‡æ–°æ¸²æŸ“</li>
<li>ç§»é™¤DOMå…ƒç´ </li>
<li>æ›¿æ¢DOMå…ƒç´ </li>
</ol>
<h2 id="å…³äºè¿™ä¸ªdemo"><a href="#å…³äºè¿™ä¸ªdemo" class="headerlink" title="å…³äºè¿™ä¸ªdemo:"></a>å…³äºè¿™ä¸ªdemo:</h2><p>è¿™æ˜¯ä¸€ä¸ªç®€å•<a href="http://codepen.io/rajaraodv/pen/BQxmjj" target="_blank" rel="external">è¿‡æ»¤æœç´¢åº”ç”¨</a>ï¼Œ ä»…åŒ…å«æœ‰ä¸¤ä¸ªç»„ä»¶â€œ<strong>FilteredList</strong>â€ å’Œ â€œ<strong>List</strong>â€ã€‚è¿™ä¸ªListç»„ä»¶æ¸²æŸ“åˆ—è¡¨é¡¹ï¼ˆé»˜è®¤æ˜¯â€œCaliforniaâ€ å’Œ â€œNew Yorkâ€ï¼‰ã€‚è¿™ä¸ªåº”ç”¨æœ‰ä¸€ä¸ªæœç´¢çš„åŒºåŸŸï¼Œå¯ä»¥æ ¹æ®å­—æ¯æ¥è¿‡æ»¤åˆ—è¡¨é¡¹ã€‚éå¸¸çš„ç›´è§‚ã€‚</p>
<p><img src="http://p0.qhimg.com/t01b37599547858bd50.png" alt=""></p>
<p>ç›¸å…³å›¾ç‰‡</p>
<blockquote>
<p>åº”ç”¨ä»£ç : <a href="http://codepen.io/rajaraodv/pen/BQxmjj" target="_blank" rel="external">http://codepen.io/rajaraodv/pen/BQxmjj</a></p>
</blockquote>
<h2 id="å¤§å›¾"><a href="#å¤§å›¾" class="headerlink" title="å¤§å›¾"></a>å¤§å›¾</h2><p>é«˜çº§ä¸€ç‚¹å„¿ï¼Œæˆ‘ä»¬ç”¨JSXå†™äº†ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡<a href="http://babeljs.io" target="_blank" rel="external">babel</a>çš„å‘½ä»¤è¡Œå·¥å…·å°†å…¶è½¬æ¢ä¸ºåŸç”Ÿçš„JS.ç„¶åPreactçš„â€œhâ€å‡½æ•°å°†å®ƒè½¬æ¢ä¸ºè™šæ‹ŸDOMæ ‘ï¼ˆä¹Ÿç§°ä¸º VNodeï¼‰ã€‚æœ€åPreactçš„è™šæ‹ŸDOMç®—æ³•ï¼Œæ ¹æ®è™šæ‹ŸDOMåˆ›å»ºä¸€ä¸ªçœŸå®çš„DOMï¼Œæ¥æ„æˆæˆ‘ä»¬çš„åº”ç”¨ã€‚</p>
<p><img src="http://p0.qhimg.com/t01b1706035bde74895.png" alt=""></p>
<p>å¤§å›¾</p>
<p><strong>åœ¨æˆ‘ä»¬æ·±å…¥ç†è§£VDOMçš„ç”Ÿå‘½å‘¨æœŸä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç†è§£ä¸‹JSXï¼Œå®ƒä¸ºåº“æä¾›äº†åŸºç¡€</strong></p>
<h2 id="Babel-å’Œ-JSX"><a href="#Babel-å’Œ-JSX" class="headerlink" title="Babel å’Œ JSX"></a>Babel å’Œ JSX</h2><p>åœ¨Reactä¸­ï¼ŒåƒPreactè¿™æ ·çš„åº“ï¼Œæ²¡æœ‰HTMLè¯­æ³•ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<strong>ä¸€åˆ‡çš†Javascript</strong>ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç”¨Javascriptæ¥å†™HTMLã€‚ä½†æ˜¯ç”¨åŸç”ŸJSå†™DOMæ˜¯ä¸€ç§å™©æ¢¦ã€‚ ğŸ˜±</p>
<p>å¯¹äºæˆ‘ä»¬çš„åº”ç”¨ï¼Œæˆ‘ä»¬å°†ä¼šåƒä¸‹é¢è¿™æ ·ä¹¦å†™HTML:</p>
<blockquote>
<p>æ³¨æ„: ç­‰ä¼šå„¿æˆ‘ä¼šä»‹ç»â€œhâ€</p>
</blockquote>
<p><img src="http://p0.qhimg.com/t01962ca01dcca88140.png" alt=""></p>
<p><img src="http://p0.qhimg.com/t01f5c9f9afe32faf8f.png" alt=""></p>
<p>è¿™å°±æ˜¯JSXçš„ç”±æ¥ï¼ŒJSXæœ¬è´¨ä¸Šå…è®¸æˆ‘ä»¬åœ¨Javascriptä¸­ä¹¦å†™HTML!å¹¶ä¸”å…è®¸æˆ‘ä»¬åœ¨HTMLä¸­çš„{}å·ä¸­ä½¿ç”¨JSçš„è¯­æ³•ã€‚</p>
<p>JSXå¸®åŠ©æˆ‘ä»¬åƒä¸‹é¢è¿™æ ·å¾ˆå®¹æ˜“çš„ä¹¦å†™ç»„ä»¶ï¼š</p>
<p><img src="http://p0.qhimg.com/t015003f0947a687084.png" alt=""></p>
<p><img src="http://p0.qhimg.com/t01caeb3d84508386a6.png" alt=""></p>
<h3 id="å°†JSXæ ‘è½¬æ¢ä¸ºJavascript"><a href="#å°†JSXæ ‘è½¬æ¢ä¸ºJavascript" class="headerlink" title="å°†JSXæ ‘è½¬æ¢ä¸ºJavascript"></a>å°†JSXæ ‘è½¬æ¢ä¸ºJavascript</h3><p>JSXå¾ˆé…·ï¼Œä½†æ˜¯ä¸æ˜¯åˆæ³•çš„JS,ä½†æ˜¯æ ¹æœ¬ä¸Šæˆ‘ä»¬è¿˜æ˜¯éœ€è¦çœŸå®çš„DOMã€‚JSXä»…ä»…æ˜¯å¸®åŠ©æˆ‘ä»¬ä¹¦å†™çœŸå®DOMçš„ä¸€ç§æ–¹æ³•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒæ¯«æ— ç”¨å¤„ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•å°†JSXè½¬æ¢ä¸ºæ­£ç¡®çš„JSONå¯¹è±¡ï¼ˆVDOM ä¹Ÿæ˜¯ä¸€ä¸ªâ€œæ ‘â€å½¢çš„ç»“æ„ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å°†JSXä½œä¸ºåˆ›å»ºçœŸå®DOMçš„åŸºç¡€ã€‚æˆ‘ä»¬å‡½æ•°æ¥åšè¿™æ ·çš„äº‹æƒ….</p>
<p>åœ¨Preactä¸­è¿™ä¸ªå‡½æ•°å°±æ˜¯<a href="https://github.com/developit/preact/blob/master/src/h.js" target="_blank" rel="external">â€œhâ€å‡½æ•°</a>.å®ƒä½œç”¨å’ŒReactä¸­çš„<a href="https://facebook.github.io/react/docs/react-api.html#createelement" target="_blank" rel="external">React.createElement</a>ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p>â€œhâ€æ˜¯æŒ‡ <a href="https://github.com/dominictarr/hyperscript" target="_blank" rel="external">hyperscript</a>â€Š- ä¸€ç§å¯ä»¥é€šè¿‡JSæ¥åˆ›å»ºHTMLçš„åº“ã€‚</p>
</blockquote>
<p>ä½†æ˜¯æ€æ ·å°†JSXè½¬æ¢ä¸ºâ€œhâ€å‡½æ•°å¼çš„è°ƒç”¨ï¼Ÿè¿™å°±æ˜¯<a href="http://babeljs.io" target="_blank" rel="external">Babel</a>çš„ç”±æ¥ã€‚Babelå¯ä»¥å¾ˆè½»æ¾çš„éå†JSXçš„èŠ‚ç‚¹ï¼Œç„¶åå°†å®ƒä»¬è½¬æ¢ä¸ºâ€œhâ€å‡½æ•°å¼çš„è°ƒç”¨ã€‚</p>
<p><img src="http://p0.qhimg.com/t01d00183b2ca94d1b5.png" alt=""></p>
<h3 id="Babel-JSX-React-Vs-Preact"><a href="#Babel-JSX-React-Vs-Preact" class="headerlink" title="Babel JSX (React Vs Preact)"></a><strong>Babel JSX (React Vs Preact)</strong></h3><p>åœ¨Reactä¸­babelä¼šå°†JSXè½¬æ¢ä¸ºReact.createElementå‡½æ•°è°ƒç”¨</p>
<p><img src="http://p0.qhimg.com/t01b6fed34159efe6ff.png" alt=""></p>
<p>å·¦è¾¹: JSX å³è¾¹: React çš„JSç‰ˆæœ¬ (ç‚¹å‡»æ”¾å¤§)</p>
<p>æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·å¢åŠ [Babel Pragma]é…ç½®ï¼Œå¯ä»¥å¾ˆè½»æ¾ä¸ºPreactçš„å‡½æ•°çš„åå­—èµ·ä»»ä½•ä¸€ä¸ªä½ æƒ³èµ·çš„åå­—ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Option <span class="number">1</span>:</span><br><span class="line"><span class="comment">//.babelrc</span></span><br><span class="line">&#123;   <span class="string">"plugins"</span>: [</span><br><span class="line">      [<span class="string">"transform-react-jsx"</span>, &#123; <span class="string">"pragma"</span>: <span class="string">"h"</span> &#125;]</span><br><span class="line">     ] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Option <span class="number">2</span>:</span><br><span class="line"><span class="comment">//Add the below comment as the 1st line in every JSX file</span></span><br><span class="line"><span class="string">`/** @jsx h */`</span></span><br></pre></td></tr></table></figure>
<p><img src="http://p0.qhimg.com/t01b0f84460957163e6.png" alt=""></p>
<p>â€œhâ€ â€”é€šè¿‡Babelçš„é…ç½® (ç‚¹å‡»æ”¾å¤§)</p>
<h3 id="æŒ‚è½½åˆ°çœŸå®DOM"><a href="#æŒ‚è½½åˆ°çœŸå®DOM" class="headerlink" title="æŒ‚è½½åˆ°çœŸå®DOM"></a>æŒ‚è½½åˆ°çœŸå®DOM</h3><p>ç»„ä»¶çš„çš„renderæ–¹æ³•ä¸­çš„ä»£ç ä¸ä»…è¢«è½¬æ¢ä¸ºâ€œhâ€å‡½æ•°ï¼Œè€Œä¸”å¼€å§‹æŒ‚è½½ã€‚</p>
<p><strong>è¿™æ˜¯æ‰§è¡Œå’Œä¸€åˆ‡çš„å¼€å§‹</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Mount to real DOM</span></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">FilteredList</span>/&gt;</span></span>, <span class="built_in">document</span>.getElementById(â€˜appâ€™));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Converted to "h":</span></span><br><span class="line">render(**h(FilteredList)**, <span class="built_in">document</span>.getElementById(â€˜appâ€™));</span><br></pre></td></tr></table></figure>
<h3 id="â€œhâ€å‡½æ•°çš„è¾“å‡º"><a href="#â€œhâ€å‡½æ•°çš„è¾“å‡º" class="headerlink" title="â€œhâ€å‡½æ•°çš„è¾“å‡º"></a>â€œhâ€å‡½æ•°çš„è¾“å‡º</h3><p>The â€œhâ€ function takes the output of JSX and creates something called a â€œVNodeâ€ (Reactâ€™s â€œcreateElementâ€ creates ReactElement). A Preactâ€™s â€œVNodeâ€ (or a Reactâ€™s â€œElementâ€) is simply a JS object representation of a single DOM node with itâ€™s properties and children.</p>
<p>çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">"nodeName"</span>: <span class="string">""</span>,</span><br><span class="line">   <span class="string">"attributes"</span>: &#123;&#125;,</span><br><span class="line">   <span class="string">"children"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„åº”ç”¨çš„Inputè¡¨å•çš„VNodeåƒè¿™æ ·ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">"nodeName"</span>: <span class="string">"input"</span>,</span><br><span class="line">   <span class="string">"attributes"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">    <span class="string">"placeholder"</span>: <span class="string">"Search"</span>,</span><br><span class="line">    <span class="string">"onChange"</span>: <span class="string">""</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"children"</span>: []</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Note: â€œhâ€ function doesnâ€™t create the entire tree!</strong> It simply creates JS object for a given node. But since the â€œ<strong>render</strong>â€ method already has the DOM JSX in a tree fashion, the end result will be a VNode with children and grand children that looks like a tree.<br><strong>æ³¨æ„â€œhâ€å‡½æ•°ä¸ä¼šåˆ›å»ºå®Œæ•´çš„æ ‘</strong> å®ƒä»…ä»…å¯¹äºç»™å®šçš„nodeåˆ›å»ºäº†ä¸€ä¸ªJSå¯¹è±¡ã€‚ä½†æ˜¯ã€‚ æœ€åçš„ç»“æœå°†ä¼šæ˜¯ä¸€ä¸ªå¸¦æœ‰å­å…ƒç´ å’Œçœ‹èµ·æ¥åƒæ ‘çš„é‡è¦å­å…ƒç´ çš„VNode.</p>
<p><strong><em>å‚è€ƒä»£ç :</em></strong></p>
<p><strong><em>â€œhâ€ :</em></strong><a href="https://github.com/developit/preact/blob/master/src/h.js" target="_blank" rel="external"><em>https://github.com/developit/preact/blob/master/src/h.js</em></a></p>
<p><strong>VNode</strong>: <a href="https://github.com/developit/preact/blob/master/src/vnode.js" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/vnode.js</a></p>
<p><strong><em>â€œrenderâ€:</em></strong> <a href="https://github.com/developit/preact/blob/master/src/render.js" target="_blank" rel="external"><em>https://github.com/developit/preact/blob/master/src/render.js</em></a></p>
<p><strong>â€œbuildComponentFromVNode:</strong> <a href="https://github.com/developit/preact/blob/master/src/vdom/diff.js#L102" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/vdom/diff.js#L102</a></p>
</blockquote>
<p>å¥½äº†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹è™šæ‹ŸDOMå¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p>
<h2 id="Preactè™šæ‹ŸDOMçš„ç®—æ³•æµç¨‹å›¾"><a href="#Preactè™šæ‹ŸDOMçš„ç®—æ³•æµç¨‹å›¾" class="headerlink" title="Preactè™šæ‹ŸDOMçš„ç®—æ³•æµç¨‹å›¾"></a>Preactè™šæ‹ŸDOMçš„ç®—æ³•æµç¨‹å›¾</h2><p>ä¸‹é¢çš„æµç¨‹å›¾å±•ç°äº†ç»„ä»¶å’Œå­ç»„ä»¶å¦‚ä½•è¢«Preactåˆ›å»ºï¼Œæ›´æ–°ï¼Œåˆ é™¤çš„ã€‚ä¹Ÿå±•ç°äº†ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µï¼Œå¯¹åº”çš„å›è°ƒå‡½æ•°è¢«è°ƒç”¨ï¼Œåƒâ€œcomponentWillMountâ€ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š æˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥çš„å¤ä¹ æ¯ä¸€éƒ¨åˆ†ï¼Œå¦‚æœä½ ä¼šè§‰å¤æ‚ï¼Œä¸ç”¨æ‹…å¿ƒã€‚</p>
</blockquote>
<p><img src="http://p0.qhimg.com/t01650dd501e89e96a2.png" alt=""></p>
<p>æ˜¯çš„ï¼Œç«‹é©¬ç†è§£æ‰€æœ‰çš„çŸ¥è¯†å¾ˆéš¾ã€‚è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥å¾—é€šè¿‡æµè§ˆä¸åŒçš„æƒ…æ™¯ï¼Œæ¥å¤ä¹ æµç¨‹å›¾çš„ä¸åŒéƒ¨åˆ†ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š å½“è®¨è®ºåˆ°å…³é”®çš„ç”Ÿå‘½å‘¨æœŸçš„éƒ¨åˆ†æˆ‘å°†ä¼šç”¨é»„è‰²é«˜äº®ã€‚</p>
</blockquote>
<h3 id="APPåˆ›å»ºåˆå§‹åŒ–"><a href="#APPåˆ›å»ºåˆå§‹åŒ–" class="headerlink" title="APPåˆ›å»ºåˆå§‹åŒ–"></a>APPåˆ›å»ºåˆå§‹åŒ–</h3><h4 id="å¯¹ä¸€ä¸ªç»™å®šçš„ç»„ä»¶åˆ›å»ºä¸€ä¸ªVNode"><a href="#å¯¹ä¸€ä¸ªç»™å®šçš„ç»„ä»¶åˆ›å»ºä¸€ä¸ªVNode" class="headerlink" title="â€Šå¯¹ä¸€ä¸ªç»™å®šçš„ç»„ä»¶åˆ›å»ºä¸€ä¸ªVNode"></a>â€Šå¯¹ä¸€ä¸ªç»™å®šçš„ç»„ä»¶åˆ›å»ºä¸€ä¸ªVNode</h4><p>é»„è‰²é«˜äº®åŒºåŸŸå¯¹äºä¸€ä¸ªç»™å®šçš„ç»„ä»¶åˆ›å»ºè™šæ‹ŸDOMæ•°ï¼Œåˆå§‹åŒ–å¤„ç†å¾ªç¯ã€‚æ³¨æ„æ²¡æœ‰ä¸ºå­ç»„ä»¶åˆ›å»ºè™šæ‹ŸDOMï¼ˆè¿™æ˜¯ä¸ªä¸åŒçš„å¾ªç¯ï¼‰</p>
<p><img src="http://p0.qhimg.com/t01664655dceb95a9a1.png" alt=""></p>
<p>é»„è‰²åŒºåŸŸå±•ç¤ºäº†è™šæ‹ŸDOMçš„åˆ›å»º</p>
<p>ä¸‹é¢è¿™å¼ å›¾ç‰‡å±•ç¤ºäº†å½“æˆ‘ä»¬åº”ç”¨ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™ä¸ªåº“æœ€ç»ˆä¸ºä¸»è¦ç»„ä»¶â€œFilteredListâ€åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰å­å…ƒç´ å’Œå±æ€§çš„VNodeã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š å®ƒè¿ç€è°ƒç”¨äº†ç”Ÿå‘½å‘¨æœŸæ–¹æ³•â€œcomponentWillMountâ€ å’Œ â€œrenderâ€.(çœ‹ä¸Šé¢å›¾ç‰‡ç»¿è‰²çš„éƒ¨åˆ†)</p>
</blockquote>
<p><img src="http://p0.qhimg.com/t01fcd8446c6c92d5b0.png" alt=""></p>
<p>(click to zoom)</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æœ‰äº†ä¸ªâ€œ<strong>div</strong>â€çš„çˆ¶å…ƒç´ ï¼Œå®ƒåŒ…å«äº†å­èŠ‚ç‚¹â€œ<strong>input</strong>â€å’Œâ€œ<strong>list</strong>â€ã€‚</p>
<blockquote>
<p><strong>å¼•ç”¨:</strong></p>
<p><em>å¤§å¤šæ•°çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ŒåƒcomponentWillMount,renderç­‰ç­‰:</em> <a href="https://github.com/developit/preact/blob/master/src/vdom/component.js#L101" target="_blank" rel="external"><em>https://github.com/developit/preact/blob/master/src/vdom/component.j</em></a>_s_</p>
</blockquote>
<h4 id="å¦‚æœä¸æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªçœŸå®çš„DOM"><a href="#å¦‚æœä¸æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªçœŸå®çš„DOM" class="headerlink" title="â€Šå¦‚æœä¸æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªçœŸå®çš„DOM"></a>â€Šå¦‚æœä¸æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªçœŸå®çš„DOM</h4><p>è¿™ä¸€æ­¥ï¼Œå®ƒä»…ä¼šå¯¹çˆ¶å…ƒç´ divåˆ›å»ºä¸€ä¸ªçœŸå®çš„DOMï¼Œå¹¶ä¸”å¯¹äºå­èŠ‚ç‚¹ï¼ˆâ€œinputâ€ å’Œ â€œListâ€ï¼‰é‡å¤è¿™ä¸€æ­¥éª¤ã€‚</p>
<p><img src="http://p0.qhimg.com/t01dcb74436f87867b2.png" alt=""></p>
<p>é»„è‰²çš„å¾ªç¯éƒ¨åˆ†å±•ç°äº†å­ç»„ä»¶çš„åˆ›å»ºã€‚</p>
<p>è¿™ä¸€æ­¥ï¼Œä¸‹é¢çš„å›¾ç‰‡ä¸­ä»…ä»…â€œdivâ€è¢«æ˜¾ç¤ºå‡ºæ¥äº†ã€‚</p>
<p><img src="http://p0.qhimg.com/t01adebc68f3eb03aea.png" alt=""></p>
<blockquote>
<p><strong>å¼•ç”¨:</strong></p>
<p>document.createElement: <a href="https://github.com/developit/preact/blob/master/src/dom/recycler.js" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/dom/recycler.js</a></p>
</blockquote>
<h4 id="å¯¹æ‰€æœ‰çš„å­å…ƒç´ é‡å¤è¿™ä¸€æ­¥"><a href="#å¯¹æ‰€æœ‰çš„å­å…ƒç´ é‡å¤è¿™ä¸€æ­¥" class="headerlink" title="â€Šå¯¹æ‰€æœ‰çš„å­å…ƒç´ é‡å¤è¿™ä¸€æ­¥"></a>â€Šå¯¹æ‰€æœ‰çš„å­å…ƒç´ é‡å¤è¿™ä¸€æ­¥</h4><p>è¿™ä¸€æ­¥ï¼Œå¯¹æ‰€æœ‰çš„å­å…ƒç´ å°†ä¼šé‡å¤è¿™ä¸€æ­¥ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œä¼šå¯¹â€œinputâ€ å’Œ â€œListâ€ é‡å¤ã€‚</p>
<p><img src="http://p0.qhimg.com/t01966ffb3fa1564b4b.png" alt=""></p>
<p>å¯¹æ¯ä¸€ä¸ªå­å…ƒç´ é‡å¤</p>
<h4 id="å¤„ç†å­å…ƒç´ ï¼Œå¹¶ä¸”æŠŠå®ƒåŠ åˆ°çˆ¶å…ƒç´ ä¸Š"><a href="#å¤„ç†å­å…ƒç´ ï¼Œå¹¶ä¸”æŠŠå®ƒåŠ åˆ°çˆ¶å…ƒç´ ä¸Š" class="headerlink" title="â€Šå¤„ç†å­å…ƒç´ ï¼Œå¹¶ä¸”æŠŠå®ƒåŠ åˆ°çˆ¶å…ƒç´ ä¸Š."></a>â€Šå¤„ç†å­å…ƒç´ ï¼Œå¹¶ä¸”æŠŠå®ƒåŠ åˆ°çˆ¶å…ƒç´ ä¸Š.</h4><p>è¿™ä¸€æ­¥æˆ‘ä»¬å°†ä¼šå¤„ç†å­æ ‘ã€‚æ—¢ç„¶â€œinputâ€æœ‰ä¸€ä¸ªçˆ¶å…ƒç´ â€œdivâ€,æˆ‘ä»¬å°†ä¼šæŠŠinputä½œä¸ºä¸€ä¸ªå­å…ƒç´ åŠ åˆ°divä¸­ã€‚ç„¶ååœæ­¢ï¼Œè¿”å›åˆ›å»ºâ€œListâ€ï¼ˆç¬¬äºŒä¸ªdivå­å…ƒç´ ï¼‰ã€‚</p>
<p><img src="http://p0.qhimg.com/t01257885ea61c2992d.png" alt=""></p>
<p>ç»“æŸå¤„ç†å­æ ‘</p>
<p>è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„åº”ç”¨çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·:</p>
<p><img src="http://p0.qhimg.com/t01728594789f678bc4.png" alt=""></p>
<blockquote>
<p>æ³¨æ„ï¼š â€œinputâ€è¢«åˆ›å»ºåï¼Œç”±äºæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå­å…ƒç´ ï¼Œä¸ä¼šç†è§£å¾ªç¯å’Œåˆ›å»ºâ€œListâ€ã€‚å®ƒä¼šé¦–å…ˆå°†â€œinputâ€åŠ å…¥åˆ°çˆ¶å…ƒç´ â€œdivâ€ä¸­ï¼Œç„¶åè¿”å›å¤„ç†â€œListâ€ã€‚</p>
<p><strong>å¼•ç”¨:</strong></p>
<p>appendChild: <a href="https://github.com/developit/preact/blob/master/src/vdom/diff.js" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/vdom/diff.js</a></p>
</blockquote>
<h4 id="å¤„ç†å­ç»„ä»¶ï¼ˆä»¬ï¼‰"><a href="#å¤„ç†å­ç»„ä»¶ï¼ˆä»¬ï¼‰" class="headerlink" title="å¤„ç†å­ç»„ä»¶ï¼ˆä»¬ï¼‰"></a>å¤„ç†å­ç»„ä»¶ï¼ˆä»¬ï¼‰</h4><p>æ§åˆ¶æµç¨‹å›åˆ°1.1ï¼Œå¯¹â€œListâ€ç»„ä»¶å¼€å§‹æ‰€æœ‰çš„ã€‚ä½†æ˜¯â€œListâ€æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒè°ƒç”¨â€œListâ€ç»„ä»¶çš„æ–¹æ³•<strong>render</strong>ï¼Œå¾—åˆ°ä¸€ç»„æ–°çš„è™šDOMï¼Œåƒä¸‹é¢è¿™æ ·</p>
<p><img src="http://p0.qhimg.com/t01966ffb3fa1564b4b.png" alt=""></p>
<p>å¯¹ä¸€ä¸ªå­ç»„ä»¶é‡å¤æ‰€æœ‰çš„æ“ä½œ</p>
<p>å¯¹Listç»„ä»¶é‡å¤æ“ä½œä¹‹åï¼Œè¿”å›VNodeåƒä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="http://p0.qhimg.com/t01859cedc26e787464.png" alt=""></p>
<blockquote>
<p><strong>å¼•ç”¨:</strong></p>
<p><strong>â€œbuildComponentFromVNode:</strong> <a href="https://github.com/developit/preact/blob/master/src/vdom/diff.js#L102" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/vdom/diff.js#L102</a></p>
</blockquote>
<h4 id="å¯¹æ‰€æœ‰å­èŠ‚ç‚¹é‡å¤ä¸Šé¢å››å°èŠ‚çš„æ­¥éª¤"><a href="#å¯¹æ‰€æœ‰å­èŠ‚ç‚¹é‡å¤ä¸Šé¢å››å°èŠ‚çš„æ­¥éª¤" class="headerlink" title="å¯¹æ‰€æœ‰å­èŠ‚ç‚¹é‡å¤ä¸Šé¢å››å°èŠ‚çš„æ­¥éª¤"></a>å¯¹æ‰€æœ‰å­èŠ‚ç‚¹é‡å¤ä¸Šé¢å››å°èŠ‚çš„æ­¥éª¤</h4><p>å®ƒä¼šå†ä¸€æ¬¡å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹é‡å¤ä¸Šé¢çš„æ­¥éª¤ã€‚ä¸€æ—¦å®ƒåˆ°è¾¾å­èŠ‚ç‚¹ï¼Œå°±ä¼šæŠŠå®ƒåŠ å…¥åˆ°èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œå¹¶ä¸”é‡å¤å¤„ç†ã€‚</p>
<p><img src="http://p0.qhimg.com/t01ce6b5e0e66508692.png" alt=""></p>
<p>é‡å¤è¿™ä¸€æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰çš„çˆ¶å­èŠ‚ç‚¹è¢«åˆ›å»ºå’Œæ·»åŠ ã€‚</p>
<p>ä¸‹é¢çš„å›¾ç‰‡å±•ç¤ºäº†æ¯ä¸ªèŠ‚ç‚¹çš„æ·»åŠ (æç¤ºï¼š æ·±åº¦ä¼˜å…ˆ)</p>
<p><img src="http://p0.qhimg.com/t0107d4791694611c9e.png" alt=""></p>
<p>çœŸå®çš„DOMæ ‘å¦‚ä½•è¢«è™šæ‹ŸDOMç®—æ³•åˆ›å»ºçš„ã€‚</p>
<h4 id="ç»“æŸå¤„ç†"><a href="#ç»“æŸå¤„ç†" class="headerlink" title="ç»“æŸå¤„ç†"></a>ç»“æŸå¤„ç†</h4><p>è¿™ä¸€æ­¥ï¼Œç»“æŸå¤„ç†ã€‚å®ƒä»…å¯¹æ‰€æœ‰çš„ç»„ä»¶è°ƒç”¨äº†â€œcomponentDidMountâ€(ä»å­ç»„ä»¶åˆ°çˆ¶ç»„ä»¶)å¹¶ä¸”åœæ­¢ã€‚</p>
<p><img src="http://p0.qhimg.com/t015cf94d166effd233.png" alt=""></p>
<blockquote>
<p><strong>é‡è¦æç¤º:</strong> ä¸€æ—¦æ‰€æœ‰æ‰€æœ‰åšå®Œä¹‹åï¼Œä¸€ä¸ªçœŸå®DOMçš„å¼•ç”¨è¢«æ·»åŠ åˆ°æ¯ä¸ªç»„ä»¶çš„å®ä¾‹ä¸Šå»ã€‚è¿™ä¸ªå¼•ç”¨è¢«ç”¨æ¥æ›´æ–°ï¼ˆåˆ›å»ºï¼Œæ›´æ–°ï¼Œåˆ é™¤ï¼‰æ¯”è¾ƒï¼Œé¿å…é‡å¤åˆ›å»ºåŒæ ·çš„DOMèŠ‚ç‚¹ã€‚</p>
</blockquote>
<h3 id="åˆ é™¤å¶å­èŠ‚ç‚¹"><a href="#åˆ é™¤å¶å­èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤å¶å­èŠ‚ç‚¹"></a>åˆ é™¤å¶å­èŠ‚ç‚¹</h3><p>å½“æˆ‘ä»¬è¾“å…¥â€œcalâ€ å…³é”®å­—ï¼Œç¡®è®¤ã€‚å°†ä¼šç§»é™¤æ‰ç¬¬äºŒä¸ªlistèŠ‚ç‚¹ï¼Œä¿ç•™æ‰€æœ‰çš„çˆ¶èŠ‚ç‚¹ã€‚</p>
<p><img src="http://p0.qhimg.com/t01bc4525ca178ab3c2.png" alt=""></p>
<p>è®©æˆ‘ä»¬çœ‹ä¸‹ï¼Œæ€ä¹ˆæ ·çœ‹è¿™ä¸ªæƒ…æ™¯ï¼Ÿ</p>
<h4 id="åƒä¹‹å‰é‚£æ ·åˆ›å»ºVNodes"><a href="#åƒä¹‹å‰é‚£æ ·åˆ›å»ºVNodes" class="headerlink" title="åƒä¹‹å‰é‚£æ ·åˆ›å»ºVNodes."></a>åƒä¹‹å‰é‚£æ ·åˆ›å»ºVNodes.</h4><p>å½“åˆå§‹åŒ–æ¸²æŸ“ä¹‹åï¼Œæœªæ¥çš„æ¯ä¸€ä¸ªå˜åŒ–éƒ½æ˜¯ä¸€ä¸ªæ›´æ–°ã€‚å½“éœ€è¦åˆ›å»ºVNodesæ—¶ï¼Œæ›´æ–°çš„å‘¨æœŸå·¥ä½œè·Ÿåˆ›å»ºçš„å‘¨æœŸéå¸¸çš„ç›¸ä¼¼ï¼Œå¹¶ä¸”<strong>å†ä¸€æ¬¡åˆ›å»ºæ‰€æœ‰çš„VNodes</strong>ã€‚</p>
<p>æ—¢ç„¶æ˜¯ä¸€ä¸ªç»„ä»¶çš„æ›´æ–°ï¼ˆä¸æ˜¯åˆ›å»ºï¼‰ï¼Œæ¯ä¸ªç»„ä»¶å’Œå­ç»„ä»¶éƒ½ä¼šè°ƒç”¨â€œcomponentWillReceivePropsâ€, â€œshouldComponentUpdateâ€, å’Œ â€œcomponentWillUpdateâ€</p>
<p><strong>å¦å¤–, update cycle, å¦‚æœé‚£äº›å…ƒç´ å·²ç»å­˜åœ¨ä¸ä¼šé‡å¤åˆ›å»ºçœŸå®çš„DOMã€‚</strong></p>
<p><img src="http://p0.qhimg.com/t015a5d5025d8cbbb37.png" alt=""></p>
<p>æ›´æ–°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</p>
<blockquote>
<p><strong>å¼•ç”¨</strong></p>
<p><strong>removeNode:</strong> <a href="https://github.com/developit/preact/blob/master/src/dom/index.js#L9" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/dom/index.js#L9</a></p>
<p><strong>insertBefore:</strong> <a href="https://github.com/developit/preact/blob/master/src/vdom/diff.js#L253" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/vdom/diff.js#L253</a></p>
</blockquote>
<h4 id="ç”¨å¼•ç”¨çš„çœŸå®DOMï¼Œé¿å…åˆ›å»ºé‡å¤çš„nodes"><a href="#ç”¨å¼•ç”¨çš„çœŸå®DOMï¼Œé¿å…åˆ›å»ºé‡å¤çš„nodes" class="headerlink" title="ç”¨å¼•ç”¨çš„çœŸå®DOMï¼Œé¿å…åˆ›å»ºé‡å¤çš„nodes"></a>ç”¨å¼•ç”¨çš„çœŸå®DOMï¼Œé¿å…åˆ›å»ºé‡å¤çš„nodes</h4><p>åƒä¹‹å‰æåˆ°çš„ï¼Œåœ¨åˆå§‹åŒ–åŠ è½½æœŸé—´ï¼Œæ¯ä¸ªç»„ä»¶ç›¸å¯¹åº”æˆ‘ä»¬åˆ›å»ºçš„çœŸå®DOMæ ‘æœ‰ä¸€ä¸ªå¼•ç”¨ã€‚ä¸‹é¢è¿™å¼ å›¾ç‰‡å±•ç°äº†è¿™ä¸€åˆ»æˆ‘ä»¬çš„åº”ç”¨çš„å¼•ç”¨ã€‚</p>
<p><img src="http://p0.qhimg.com/t01db912917e174e1e9.png" alt=""></p>
<p>æ˜¾ç¤ºæ¯ä¸€ä¸ªç»„ä»¶ å’Œ ä¹‹å‰çš„DOMçš„å·®å¼‚</p>
<p>å½“è™šæ‹ŸDOMè¢«åˆ›å»ºï¼Œæ¯ä¸ªè™šæ‹ŸDOMçš„å±æ€§éƒ½ä¼šè·ŸçœŸå®DOMçš„å±æ€§è¿›è¡Œæ¯”è¾ƒ<strong>å¦‚æœçœŸå®DOMå­˜åœ¨ï¼Œå¾ªç¯å¤„ç†å°†ä¼šè¿›è¡Œä¸‹ä¸€æ­¥</strong></p>
<p><img src="http://p0.qhimg.com/t01f1f88dc5c45f6dbd.png" alt=""></p>
<p>çœŸå®DOMå·²ç»å­˜åœ¨ï¼ˆåœ¨æ›´æ–°æœŸé—´ï¼‰</p>
<blockquote>
<p><strong>å¼•ç”¨</strong></p>
<p>innerDiffNode: <a href="https://github.com/developit/preact/blob/master/src/vdom/diff.js#L185" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/vdom/diff.js#L185</a></p>
</blockquote>
<h4 id="å¦‚æœä»–ä»¬åœ¨çœŸå®çš„DOMä¸­æ˜¯é¢å¤–çš„èŠ‚ç‚¹ï¼Œç§»é™¤ä»–ä»¬"><a href="#å¦‚æœä»–ä»¬åœ¨çœŸå®çš„DOMä¸­æ˜¯é¢å¤–çš„èŠ‚ç‚¹ï¼Œç§»é™¤ä»–ä»¬" class="headerlink" title="å¦‚æœä»–ä»¬åœ¨çœŸå®çš„DOMä¸­æ˜¯é¢å¤–çš„èŠ‚ç‚¹ï¼Œç§»é™¤ä»–ä»¬"></a>å¦‚æœä»–ä»¬åœ¨çœŸå®çš„DOMä¸­æ˜¯é¢å¤–çš„èŠ‚ç‚¹ï¼Œç§»é™¤ä»–ä»¬</h4><p>ä¸‹é¢çš„å›¾ç‰‡å±•ç°äº†çœŸå®DOMå’Œè™šæ‹ŸDOMçš„å·®å¼‚</p>
<p><img src="http://p0.qhimg.com/t017b07b476b9c72aef.png" alt=""></p>
<p>(click to zoom)</p>
<p>è¿™é‡Œæœ‰ä¸€ç‚¹å„¿ä¸åŒã€‚åœ¨çœŸå®èŠ‚ç‚¹ä¸­çš„â€œNew Yorkâ€èŠ‚ç‚¹è¢«ç®—æ³•ç§»é™¤äº†åƒä¸‹é¢æµç¨‹å›¾é‚£æ ·ã€‚å½“æ‰€æœ‰å·¥ä½œè¿›è¡Œå®Œæ¯•ç®—æ³•ä¹Ÿä¼šè°ƒç”¨â€œcomponentDidUpdateâ€ã€‚</p>
<p><img src="http://p0.qhimg.com/t01a84a880aeccf04a9.png" alt=""></p>
<p>ç§»é™¤DOMèŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ</p>
<h3 id="å¸è½½æ•´ä¸ªç»„ä»¶"><a href="#å¸è½½æ•´ä¸ªç»„ä»¶" class="headerlink" title="å¸è½½æ•´ä¸ªç»„ä»¶"></a>å¸è½½æ•´ä¸ªç»„ä»¶</h3><p>è®©æˆ‘ä»¬çœ‹çœ‹åœ¨filterç»„ä»¶ä¸­è¾“å…¥<strong>blabla</strong>ï¼Œæ—¢ç„¶æ²¡æœ‰åŒ¹é…åˆ°â€œCaliforniaâ€ å’Œ â€œNew Yorkâ€, æˆ‘ä»¬ä¸ä¼šæ¸²æŸ“å­ç»„ä»¶â€œListâ€,è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å¸è½½æ•´ä¸ªç»„ä»¶ã€‚</p>
<p><img src="http://p0.qhimg.com/t011fc57fa43c385ab2.png" alt="">å¦‚æœæ²¡æœ‰ç»“æœçš„è¯Listç»„ä»¶æ²¡æœ‰è¢«ç§»é™¤</p>
<p><img src="http://p0.qhimg.com/t0163a27c31d0e173cb.png" alt="">ç»„ä»¶FilteredListçš„renderæ–¹æ³•</p>
<p>åˆ é™¤ä¸€ä¸ªç»„ä»¶è·Ÿåˆ é™¤ä¸€ä¸ªå•ä¸€èŠ‚ç‚¹å·®ä¸å¤šï¼Œå½“æˆ‘ä»¬åˆ é™¤ä¸€ä¸ªç›¸å¯¹äºç»„ä»¶æœ‰å¼•ç”¨çš„èŠ‚ç‚¹ï¼Œæ¡†æ¶ä¼šè°ƒç”¨â€œcomponentWillUnmountâ€,ç„¶åå®‰å…¨çš„åˆ é™¤æ‰€æœ‰çš„DOMå…ƒç´ ã€‚å½“æ‰€æœ‰çš„å…ƒç´ ä»çœŸå®DOMç§»é™¤ï¼Œå°†ä¼šè°ƒç”¨å¼•ç”¨çš„ç»„ä»¶çš„â€œcomponentDidUnmountâ€æ–¹æ³•ã€‚</p>
<p>ä¸‹é¢çš„å›¾ç‰‡æ˜¾ç¤ºåœ¨çœŸå®çš„DOMâ€œulâ€ä¸­ï¼Œâ€œListâ€ç»„ä»¶çš„å¼•ç”¨ã€‚</p>
<p><img src="http://p0.qhimg.com/t01efcb4c720da55814.png" alt=""></p>
<p>ä¸‹é¢æµç¨‹å›¾çš„é«˜äº®éƒ¨åˆ†å±•ç°äº†ç§»é™¤å’Œå¸è½½ç»„ä»¶çš„è¿‡ç¨‹</p>
<p><img src="http://p0.qhimg.com/t01f8b4703563e3d64b.png" alt=""></p>
<p>ç§»é™¤å’Œå¸è½½ç»„ä»¶</p>
<blockquote>
<p><strong>å¼•ç”¨</strong></p>
<p>unmountComponent: <a href="https://github.com/developit/preact/blob/master/src/vdom/component.js#L250" target="_blank" rel="external">https://github.com/developit/preact/blob/master/src/vdom/component.js#L250</a></p>
</blockquote>
<h2 id="æœ€åä¸€ç‚¹"><a href="#æœ€åä¸€ç‚¹" class="headerlink" title="æœ€åä¸€ç‚¹:"></a><strong>æœ€åä¸€ç‚¹:</strong></h2><p>æˆ‘å¸Œæœ›è¿™ç¯‡åšæ–‡èƒ½å¤Ÿç»™ä½ å…³äºè™šæ‹ŸDOMå¦‚ä½•å·¥ä½œè¶³å¤Ÿçš„å¯ç¤ºï¼ˆè‡³å°‘åœ¨Preactä¸­ï¼‰ã€‚</p>
<p>è™½ç„¶è¿™äº›è¦†ç›–äº†ä¸»è¦çš„åœºæ™¯ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡è®²åˆ°ä»£ç çš„ä¼˜åŒ–ã€‚</p>
<p><strong>å¦‚æœä½ å‘ç°é—®é¢˜ï¼Œé€šçŸ¥æˆ‘ï¼Œæˆ‘éå¸¸ä¹æ„æ›´æ–°ï¼å¦‚æœä½ æƒ³çŸ¥é“æ›´å¤šï¼Œä¹Ÿè¯·å‘Šè¯‰æˆ‘ï¼</strong></p>
<p>å°±è¿™æ ·! ğŸ™ğŸ¼ ğŸ‘</p>
<p><em>ğŸ‰ğŸ‰ğŸ‰</em> <strong><em>å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« , please 1.</em></strong> ğŸ’š<strong>åœ¨Mediumç‚¹å–œæ¬¢ and 2. åœ¨twitterä¸Šåˆ†äº«._</strong><em>ğŸ‰ğŸ‰ğŸ‰</em></p>
<p>ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æˆ‘: <a href="https://twitter.com/rajaraodv" target="_blank" rel="external">https://twitter.com/rajaraodv</a></p>

        </div>
        <footer class="article-footer">
            
    <div class="jiathis_style_24x24">
    <span class="jiathis_txt">åˆ†äº«åˆ°ï¼š</span>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_tsina"</a>
    <a class="jiathis_button_weixin"></a>
    <a class="jiathis_button_douban"></a>
    <a class="jiathis_button_fb"></a>
    <a class="jiathis_button_twitter"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>




        </footer>

    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


              </div>
            </section>
            
          </div>
        </div>
      </div>
      <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 tcatche</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. </p>
                <p>Theme based <a href="//github.com/ppoffice" target="_blank">PPOffice</a> and modify by Tcatche. </p>
                <p>Hosted by <a  href="https://pages.github.com/">Github Pages</a>. </p>
            </div>
        </div>
    </div>
</footer>
      <div id="fixed">
  <i class="fa fa-align-justify ins-search-icon"></i>
  <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æœªå‘½å)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>
  <i id="back-to-top" class="fa fa-arrow-up goto-top"></i>
</div>
      
    
    <script>
    var disqus_shortname = 'tcatche';
    
    
    var disqus_url = 'http://tcatche.site/2017/07/the-inner-workings-of-virtual-dom-rajaraodv-medium/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
  </div>
</body>
</html>
